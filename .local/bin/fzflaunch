#!/usr/bin/env bash
# bmenu - Shell application launcher using fzf.
# Searches $PATH for executable files and runs selected program.
# Fzf preview window shows info about file.
# Requires: fzf
# Usage: As script like ~/bin/bmenu or copy/paste bmenu() function in ~/.bashrc

export FZF_DEFAULT_OPTS="--height=100% --layout=reverse --border --no-sort --prompt=\"~ \" --color=dark,hl:red:regular,fg+:white:regular,hl+:red:regular:reverse,query:white:regular,info:gray:regular,prompt:red:bold,pointer:red:bold"

bmenu() {
launchapp=$(IFS=':'; \
  for p in ${PATH}; \
  do find -L "${p}" -type f -executable -print 2> /dev/null; done \
  | fzf --header="Select application to launch from PATH:" \
    --multi=0 \
    --height="100%" \
    --preview="(file -b {})" \
    --preview-window="down:wrap:3")
  if [[ "${launchapp}" ]]; then
    nohup ${SHELL:-"/bin/sh"} -c "${launchapp}" >/dev/null &
  fi
}

bmenu "$@"
